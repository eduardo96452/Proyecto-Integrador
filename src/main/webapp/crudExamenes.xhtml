<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Examenes</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"/><!-- comment -->

        <link href="Recursosappweb/css/estilocrudpersona.css" rel="stylesheet" type="text/css"/>
        <style>
            .ui-datatable-frozenlayout-left {
                width: 20%;
            }

            .ui-datatable-frozenlayout-right {
                width: 80%;
            }
        </style>
    </h:head>
    <h:body>
        <div>           
            <h:form>
                <p:growl id="messages"/>

                <p:menubar>

                    <p:menuitem value="Inicio" icon="pi pi-fw pi pi-home" outcome="pantallaLaboratorista"/>

                    <p:menuitem value="Usuarios" icon="pi pi-fw pi-user" outcome="crudPersonas"/>

                    <p:menuitem value="Examenes" icon="pi pi-fw pi-file" outcome="crudExamenes"/>                     

                    <p:divider layout="vertical"/>

                    <p:submenu label="nombre" icon="pi pi-user">
                        <p:menuitem value="Perfil" icon="pi pi-user-edit"/>
                    </p:submenu>

                    <f:facet name="options">                        
                        <h:commandLink value="" action="iniciarSesion.xhtml">                            
                            <p:button value="Cerrar Sesión" icon="pi pi-fw pi-sign-out" styleClass="ui-button-info"/>
                        </h:commandLink>

                    </f:facet>
                </p:menubar>
            </h:form>
        </div>
        <div class="card">
            <h:form>
                <p:breadCrumb>
                    <p:menuitem value="Inicio" outcome="pantallaLaboratorista"/>
                    <p:menuitem value="Examenes"/>
                </p:breadCrumb>
            </h:form>
        </div>
        <br/>
        <p class="text-center">"Usted puede <strong>Agregar, Buscar, Actualizar y Eliminar</strong> en este apartado cualquier examenen"</p>
        <div class="card crud-demo margen">
            <h:form id="form">
                <p:growl id="messages" showDetail="true" />

                <p:toolbar>
                    <p:toolbarGroup>
                        <p:commandButton value="Agregar exámen" icon="pi pi-plus" actionListener="#{crudView.openNew}"
                                         update=":dialogs:manage-busqueda-paciente" oncomplete="PF('AdministradorBusquedaPaciente').show()"
                                         styleClass="ui-button-success" style="margin-right: .5rem">
                            <!--p:resetInput target=":dialogs:manage-product-content" /-->
                            <p:resetInput target=":dialogs:manage-busqueda-paciente" />
                        </p:commandButton>
                        <!-- COLOCAR rendered="#{false}" EN ELIMINAR, LUEGO-->
                        <p:commandButton id="delete-products-button" value="#{crudView.deleteButtonMessageExamen}"
                                         icon="pi pi-trash" actionListener="#{crudView.deleteSelectedExamenes}"
                                         styleClass="ui-button-danger" disabled="#{!crudView.hasSelectedExamenes()}" update="@this">
                            <p:confirm header="Confirmation" message="Eliminar los examenes seleccionados?"
                                       icon="pi pi-exclamation-triangle" />
                        </p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>

                <p:dataTable id="dt-products" widgetVar="dtProducts" var="examen" value="#{crudView.examenes}"
                             reflow="true" styleClass="products-table" selection="#{crudView.selectedExamenes}"
                             rowKey="#{examen.id}" paginator="true" rows="11" rowSelectMode="add" paginatorPosition="bottom">
                    <f:facet name="header">
                        <div class="products-table-header">
                            <span style="font-weight: bold">Exámenes</span> <span
                                class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i> <p:inputText
                                    id="globalFilter" onkeyup="PF('dtProducts').filter()" placeholder="Buscar" />
                            </span>
                        </div>
                    </f:facet>

                    <p:ajax event="rowSelect" update=":form:delete-products-button" />
                    <p:ajax event="rowUnselect" update=":form:delete-products-button" />
                    <p:ajax event="rowSelectCheckbox" update=":form:delete-products-button" />
                    <p:ajax event="rowUnselectCheckbox" update=":form:delete-products-button" />
                    <p:ajax event="toggleSelect" update=":form:delete-products-button" />

                    <p:column selectionMode="multiple" exportable="false"></p:column>

                    <p:column headerText="Orden" sortBy="#{examen.idOrden}" filterBy="#{examen.idOrden}">
                        <h:outputText value="#{examen.idOrden}" />
                    </p:column>
                    <p:column headerText="Identificador" sortBy="#{examen.id}" filterBy="#{examen.id}">
                        <h:outputText value="#{examen.id}" />
                    </p:column>
                    <p:column headerText="NombrePaciente" sortBy="#{examen.nombrePaciente}" filterBy="#{examen.nombrePaciente}">
                        <h:outputText value="#{examen.nombrePaciente}" />
                    </p:column>
                    <p:column headerText="CategoriaExamen" sortBy="#{examen.nombreExamen}" filterBy="#{examen.nombreExamen}">
                        <h:outputText value="#{examen.nombreExamen}" />
                    </p:column>
                    <p:column headerText="FechaDeRegistro" sortBy="#{examen.fechaRegistro}" filterBy="#{examen.fechaRegistro}">
                        <h:outputText value="#{examen.fechaRegistro}" />
                    </p:column>
                    <p:column headerText="FechaEntrega" sortBy="#{examen.fechaEntregaResult}" filterBy="#{examen.fechaEntregaResult}">
                        <h:outputText value="#{examen.fechaEntregaResult}" />
                    </p:column>
                    <p:column headerText="Observaciones" sortBy="#{examen.observaciones}" filterBy="#{examen.observaciones}">
                        <h:outputText value="#{examen.observaciones}" />
                    </p:column>
                    <p:column exportable="false">
                        <!-- ACTUALIZAR EXÁMEN -->
                        <p:commandButton icon="pi pi-pencil" update=":dialogs:manage-busqueda-paciente"
                                         actionListener="#{crudView.imprimirIdExamen(examen)}"
                                         oncomplete="PF('AdministradorBusquedaPaciente').show()"
                                         styleClass="edit-button rounded-button ui-button-success" process="@this">
                            <f:setPropertyActionListener value="#{examen}" target="#{crudView.examenSeleccionado}" />
                            <p:resetInput target=":dialogs:manage-busqueda-paciente" />
                        </p:commandButton>

                        <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" process="@this"
                                         oncomplete="PF('deleteProductDialog').show()">
                            <f:setPropertyActionListener value="#{examen}" target="#{crudView.imprimirIdExamen(examen)}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </h:form>

            <h:form id="dialogs" >                
                <!-- ELIMINAR EXAMEN -->
                <p:confirmDialog widgetVar="deleteProductDialog" showEffect="fade" width="300"
                                 message="¿Eliminar el siguiente examen?" header="Confirm" severity="warn">
                    <p:commandButton value="Si" icon="pi pi-check" actionListener="#{crudView.deleteExamen()}"
                                     process="@this" oncomplete="PF('deleteProductDialog').hide()" />
                    <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                                     onclick="PF('deleteProductDialog').hide()" />
                </p:confirmDialog>

                <p:confirmDialog global="true" showEffect="fade" width="300">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
                                     icon="pi pi-times" />
                </p:confirmDialog>
                <!-- ELEGIR PACIENTE PARA EXAMEN -->
                <p:dialog id= "pacienteExa" header="Elegir paciente para examen" showEffect="fade" modal="true" widgetVar="AdministradorBusquedaPaciente"
                          responsive="true" maximizable="true" >
                    <p:outputPanel id="manage-busqueda-paciente" class="ui-fluid">
                        <p:outputPanel rendered="#{not empty crudView.personaSeleccionada}">
                            <p:scrollPanel style="width:700px;height:500px">
                                <div class="field">
                                    <p:dataTable id="dt-pacientes" widgetVar="dtPacientes" var="person" value="#{crudView.personasE}"
                                                 reflow="true" styleClass="products-table" selection="#{crudView.selectedPersonas}"
                                                 rowKey="#{person.id}" paginator="true" rows="11" rowSelectMode="add" paginatorPosition="bottom">
                                        <f:facet name="header">
                                            <div class="products-table-header">
                                                <span style="font-weight: bold">Pacientes</span> <span
                                                    class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i> <p:inputText
                                                        id="globalFilter" onkeyup="PF('dtPacientes').filter()" placeholder="Buscar" />
                                                </span>
                                            </div>
                                        </f:facet>

                                        <p:column selectionMode="multiple" exportable="false"></p:column>

                                        <p:column headerText="Identificador" sortBy="#{person.id}" 
                                                  filterBy="#{person.id}">
                                            <h:outputText value="#{person.id}" />
                                        </p:column>
                                        <p:column headerText="Cédula" sortBy="#{person.cedula}" filterBy="#{person.cedula}">
                                            <h:outputText value="#{person.cedula}" />
                                        </p:column>
                                        <p:column headerText="Nombre" sortBy="#{person.nombres}" filterBy="#{person.nombres}">
                                            <h:outputText value="#{person.nombres}" />
                                        </p:column>
                                        <p:column headerText="Apellido" sortBy="#{person.apellidos}" filterBy="#{person.apellidos}">
                                            <h:outputText value="#{person.apellidos}" />
                                        </p:column>
                                    </p:dataTable>
                                </div>
                            </p:scrollPanel>
                        </p:outputPanel>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="Siguiente" styleClass="rounded-button ui-button-secondary"
                                         actionListener="#{crudView.pacienteSelecionado()}"
                                         update="manage-seleccionar-categorias" process="manage-seleccionar-categorias @this" 
                                         onclick="PF('pacienteExa').hide()" />
                    </f:facet>
                </p:dialog>
                <!-- MOSTRAR LAS CARTEGORÍAS DE EXÁMENES -->
                <p:dialog id= "dgcategorias" header="Elegir categorías para examen" showEffect="fade" modal="true" widgetVar="AdministradorseleccionCategorias"
                          responsive="true" maximizable="true" >
                    <p:outputPanel id="manage-seleccionar-categorias" class="ui-fluid">
                        <p:outputPanel rendered="#{not empty crudView.categoriaSeleccionada}">
                            <p:scrollPanel style="width:700px;height:500px">
                                <div class="field">
                                    <p:dataTable id="dt-categorias" widgetVar="dtCategorias" var="categorias" value="#{crudView.categorias}"
                                                 scrollable="true" scrollHeight="200" 
                                                 reflow="true" styleClass="products-table" selection="#{crudView.selectedCategorias}"
                                                 rowKey="#{categorias.idcategoria}" paginator="true" rows="11" rowSelectMode="add" paginatorPosition="bottom">
                                        <f:facet name="header">
                                            <div class="products-table-header">
                                                <span style="font-weight: bold">Categorías</span> <span
                                                    class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i> <p:inputText
                                                        id="globalFilter" onkeyup="PF('dtCategorias').filter()" placeholder="Buscar" />
                                                </span>
                                            </div>
                                        </f:facet>

                                        <p:column selectionMode="multiple" exportable="false"></p:column>

                                        <p:column headerText="Identificador"  sortBy="#{categorias.idcategoria}" 
                                                  filterBy="#{categorias.idcategoria}">
                                            <h:outputText value="#{categorias.idcategoria}" />
                                        </p:column>
                                        <p:column headerText="Nombre de exámen" sortBy="#{categorias.tipoExa}" filterBy="#{categorias.tipoExa}">
                                            <h:outputText value="#{categorias.tipoExa}" />
                                        </p:column>
                                        <p:column headerText="Precio" sortBy="#{categorias.precio}" filterBy="#{categorias.precio}">
                                            <h:outputText value="#{categorias.precio}" />
                                        </p:column>
                                    </p:dataTable>
                                </div>
                            </p:scrollPanel>
                        </p:outputPanel>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="Siguiente" styleClass="rounded-button ui-button-secondary"
                                         actionListener="#{crudView.examenesSeleccionados()}"
                                         update="manage-configurar-examen" process="manage-configurar-examen @this" 
                                         onclick="PF('dgcategorias').hide()" />
                    </f:facet>
                </p:dialog>
                <!-- CONFIGURAREXAMEN -->
                <p:dialog id= "confExa" header="Configurar exámenes" showEffect="fade" modal="true" widgetVar="ConfigurarExamen"
                          responsive="true" maximizable="true" >
                    <p:outputPanel id="manage-configurar-examen" class="ui-fluid">
                        <p:outputPanel rendered="#{not empty crudView.personaExamen}">
                            <p:scrollPanel style="width:700px;height:500px">
                                <div class="px-4">
                                    <!-- DATOS DEL USUARIO -->
                                    <div class="field">
                                        <p:outputLabel for="cedula">Cédula</p:outputLabel>
                                        <p:inputText id="cedula" value="#{crudView.personaExamen.cedula}" disabled="true" />
                                    </div>
                                    <div class="field">
                                        <p:outputLabel for="name">Nombres</p:outputLabel>
                                        <p:inputText id="name" value="#{crudView.personaExamen.nombres} #{crudView.personaExamen.apellidos}" disabled="true" />
                                    </div>
                                    <div class="field">
                                        <p:outputLabel>Exámenes a realizar</p:outputLabel><br/>
                                        <ui:repeat var="item" varStatus="status" value="#{crudView.selectedCategorias}">
                                            #{status.index+1}. #{item.tipoExa} - #{item.precio}<br/>
                                        </ui:repeat><br/>
                                    </div>
                                    <div class="field">
                                        <p:outputLabel for="fechaInicia">Fecha de exámen</p:outputLabel>
                                        <p:inputText id="fechaInicia" value="#{crudView.examen.fechaRegistro}" />
                                    </div>
                                    <div class="field">
                                        <p:outputLabel for="fechaEntrega">Fecha de entrega</p:outputLabel>
                                        <p:inputText id="fechaEntrega" value="#{crudView.examen.fechaEntregaResult}" />
                                    </div>
                                    <div class="field">
                                        <p:outputLabel for="observaciones">Observaciones</p:outputLabel>
                                        <p:inputText id="observaciones" value="#{crudView.examen.observaciones}" />
                                    </div>
                                    <div class="field">
                                        <p:outputLabel for="total">Total</p:outputLabel>
                                        <p:inputText id="total" value="#{crudView.precio}" disabled="true"/>
                                    </div>
                                </div>
                            </p:scrollPanel>
                        </p:outputPanel>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="Guardar" icon="pi pi-check" action="#{crudView.guardarExamen()}"
                                         update="manage-configurar-examen" process="manage-configurar-examen @this" 
                                         onclick="PF('confExa').hide()"/>
                    </f:facet>
                </p:dialog>
            </h:form>
        </div>        
    </h:body>
</html>

